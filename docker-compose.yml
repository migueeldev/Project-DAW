version: '3.8'

services:
  # Backend (Node.js + Express) - Ahora usa Neon
  backend:
    build: ./backend
    container_name: biblioteca-backend
    environment:
      NODE_ENV: production
      PORT: 5000
      # Usa la variable de entorno DATABASE_URL de tu .env
      DATABASE_URL: ${DATABASE_URL}
      JWT_SECRET: ${JWT_SECRET:-mi_secreto_super_seguro_cambiar_en_produccion_12345678}
      JWT_EXPIRES_IN: ${JWT_EXPIRES_IN:-7d}
    ports:
      - "5000:5000"
    networks:
      - biblioteca-network
    restart: unless-stopped
    # Ya no depende de la base de datos local
    
  # Frontend (React + Vite + Nginx)
  frontend:
    build: ./frontend
    container_name: biblioteca-frontend
    ports:
      - "80:80"
    depends_on:
      - backend
    networks:
      - biblioteca-network
    restart: unless-stopped

# Ya no necesitas el volumen de postgres
networks:
  biblioteca-network:
    driver: bridge